"use strict";var dynamicColors=function(){return"rgb("+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+")"};function removeChildrens(e){for(;e.firstChild;)e.removeChild(e.firstChild)}async function give_me_my_charts(){let e=await fetch("api/data");if(200==e.status){let t=await e.text(),a=JSON.parse(t),n={};const o=document.getElementById("charts");let l=[],r=1;Object.keys(a).forEach((e=>{n[e]={};let t=dynamicColors(),o=`Sonde ${e.replaceAll("_"," ")}`;Object.keys(a[e]).forEach((a=>{n[e][a]={label:o,data:[],setpoints:[],fill:!1,borderColor:t,tension:.5},r++}))})),r=parseInt(r/Object.keys(n).length);let s=[];s[0]="lundi",s[1]="mardi",s[2]="mercredi",s[3]="jeudi",s[4]="vendredi",s[5]="samedi",s[6]="dimanche";let d=[];Object.keys(a).forEach((e=>{Object.keys(a[e]).forEach((e=>{-1===d.indexOf(e)&&d.push(e)}))}));let c=0;function i(e,t){let n=0;for(let o of a[e][t])n+=o.RealTemp;return c+=parseFloat(n/a[e][t].length),parseFloat(n/a[e][t].length).toFixed(2)}for(let h=0;h<r;h++){const m=document.createElement("h5"),u=document.createElement("br");m.innerText=`${s[h][0].toUpperCase()}${s[h].slice(1)}`,m.style.color="white";const f=document.createElement("details"),y=document.createElement("summary");y.innerText="Températures moyennes";const b=document.createElement("table");b.role="grid";let C='\n        <thead>\n            <tr>\n                <th scope="col">Zones</th>\n                <th scope="col">Températures moyennes</th>\n            </tr>\n        </thead>\n        <tbody>';Object.keys(a).forEach((e=>{C=`${C}\n          <tr>\n            <td>${e.replaceAll("_"," ")}</td>\n            <td>${i(e,d[h])}</td>\n          </tr>`})),C=`${C}\n        <tfoot>\n          <tr>\n            <th scope="col">Température Moyenne Globale</td>\n            <th scope="col">${parseFloat(c/Object.keys(a).length).toFixed(2)}</td>\n          </tr>\n        </tfoot>`,C=`${C}</tbody>`,c=0,b.innerHTML=C,f.appendChild(y),f.appendChild(b);const E=document.createElement("canvas");E.id=s[h],E.style.border="1px solid",E.style.borderColor="white",E.style.backgroundColor="#1B1E24",o.appendChild(m),o.appendChild(f),o.appendChild(E),o.appendChild(u)}Object.keys(a).forEach((e=>{Object.keys(a[e]).forEach((t=>{for(let o of a[e][t])n[e][t].data.push(o.RealTemp),n[e][t].setpoints.push(o.Setpoint)}))}));for(let g of a.Cuisine[d[0]])l.push(g.Timestamp);let p={};Object.keys(n).forEach((e=>{Object.keys(n[e]).forEach((t=>{t in p==!1&&(p[t]=[]),p[t].push(n[e][t])}))}));for(let k=0;k<r;k++)new Chart(document.getElementById(s[k]),{type:"line",data:{labels:l,datasets:p[d[k]]},options:{plugins:{tooltip:{callbacks:{label:function(e){return[`${e.dataset.label}: ${e.dataset.data[e.dataIndex]}`,`Consigne: ${e.dataset.setpoints[e.dataIndex]}`]}}}}}})}}async function chart_per_zone(e){if("all"===e||""===e)give_me_my_charts();else{let t=await fetch(`api/data/${e.replaceAll(" ","_")}`);if(200==t.status){let a=await t.text(),n=JSON.parse(a);const o=document.getElementById("charts");let l=[],r={};Object.keys(n).forEach((e=>{let t=dynamicColors(),a=new Date(`2023-02-${e}`);r[e]={label:a.toLocaleDateString("fr-FR",{weekday:"long",month:"numeric",day:"numeric"}),data:[],setpoints:[],fill:!1,borderColor:t,tension:.5},Object.keys(n[e]).forEach((t=>{r[e].data.push(n[e][t].RealTemp),r[e].setpoints.push(n[e][t].Setpoint)}))})),console.log(r);const s=document.createElement("canvas");s.id=e.replaceAll(" ","_"),s.style.border="1px solid",s.style.borderColor="white",s.style.backgroundColor="#1B1E24";const d=document.createElement("h5");d.innerText=e,d.style.color="white",o.appendChild(d),o.appendChild(s);for(let e of n[20])l.push(e.Timestamp);let c=[];Object.keys(r).forEach((e=>{c.push(r[e])})),new Chart(document.getElementById(e.replaceAll(" ","_")),{type:"line",data:{labels:l,datasets:c},options:{plugins:{tooltip:{callbacks:{label:function(e){return[`${e.dataset.label}: ${e.dataset.data[e.dataIndex]}`,`Consigne: ${e.dataset.setpoints[e.dataIndex]}`]}}}}}})}}}async function prepare_select_options(){let e=await fetch("api/data/zones");if(200==e.status){let t=await e.text(),a=JSON.parse(t);const n=document.getElementById("options");a.forEach((e=>{const t=document.createElement("option");t.value=e,t.innerText=e,n.appendChild(t)}));const o=document.createElement("option");o.value="all",o.innerText="Toutes les zones",n.appendChild(o);const l=document.getElementById("charts");n.addEventListener("change",(e=>{removeChildrens(l),chart_per_zone(e.target.value)}))}}Chart.defaults.backgroundColor="#CCBFAB",Chart.defaults.borderColor="#CCBFAB",Chart.defaults.color="#FFF",window.addEventListener("DOMContentLoaded",(()=>{prepare_select_options()}));